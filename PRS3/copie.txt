Abstract: The motivation of this work is to help outpatients find their corresponding departments or clinics, thus, it needs to provide indoor positioning services with a room-level accuracy. Unlike wireless outdoor localization that is dominated by the global positioning system (GPS), wireless indoor localization is still an open issue. Many different schemes are being developed to meet the increasing demand for indoor localization services. In this paper, we investigated the AoA-based wireless indoor localization for outpatients’ wayfinding in a hospital, where Wi-Fi access points (APs) are deployed, in line, on the ceiling. The target position can be determined by a mobile device, like a smartphone, through an efficient geometric calculation with two known APs coordinates and the angles of the incident radios. All possible positions in which the target may appear have been comprehensively investigated, and the corresponding solutions were proven to be the same. Experimental results show that localization error was less than 2.5 m, about 80% of the time, which can satisfy the outpatients’ requirements for wayfinding.
Keywords: hospital wayfinding; indoor localization; wireless localization; Wi-Fi localization; angle of arrival (AoA); location-based services (LBS)
1. Introduction
With the popularity of mobile devices, such as smartphones, smartwatches, tablets, as well as some wearable devices, wireless localization has spawned numerous location-based services (LBS) to facilitate our daily life in the fields of emergency services, navigation, healthcare, geofence, social networking, entertainment/gaming, asset tracking, etc. [1–6]. For example, smartphone users can easily plan their trips using Google Maps and order a nearby taxi. The accurate location is mainly provided by the global positioning system (GPS). However, GPS signal is degraded too severely to be received in indoor environments. Many methods have been developed to meet the increasing demand for indoor LBS applications [7–9]. These wireless indoor localization methods and systems can be roughly divided into two main categories: range-based schemes and range-free schemes.
Range-based schemes first measure the distances between the target and at least three reference points, and then determine the target’s position by triangulation or trilateration, using the least square method. The distances are indirectly measured by interpreting some physical parameters obtained from wireless signals, such as time of flight (ToF), time of arrival (ToA), time difference of arrival (TDoA), and received signal strength indication (RSSI) [10–16]. ToF, ToA, and TDoA are very sensitive to timing error, thus, relying on highly synchronized timers. Furthermore, they usually need work under line of sight (LOS) conditions to get accurate ranging. RSSI is used to figure out the distance between the transmitter and the receiver with log-normal distance path loss (LDPL) model [17]. However, indoor RSSI is subject to temporal and spatial fluctuations because of the multipath effect, usually providing a
 Sensors 2018, 18, 3698; doi:10.3390/s18113698 www.mdpi.com/journal/sensors
Sensors 2018, 18, 3698 2 of 17
coarse-grained positioning. The RSSI is not robust to noise because signal attenuates with propagation distance while noise usually does not.
Range-free schemes can be further subdivided into a distance vector hop (DV-hop), proximity detection, fingerprint matching, and angle of arrival (AoA)-based methods [18–24]. In a wireless sensor network (WSN), hop counts are utilized to estimate the positions of sensors with initially-unknown location information, by using a priori knowledge of the absolute positions of a few sensors (named as anchor nodes) and inter-sensor measurements, such as distance and bearing [25–27]. In the proximity detection method, Bluetooth low energy (BLE) beacons are deployed to periodically broadcast advertising messages, which contain their positions and other information [19,28,29]. The nearby mobile devices detect the signal from the beacon and calculate the approximate distance to the beacon. Thus, it needs to deploy a mass of beacons to obtain an accurate location. Wi-Fi can be used in a similar way as the BLE beacons, but requires external power sources and more setup costs. Fingerprint matching is a pattern recognition approach. During the training phase, signal features of all regions of interest are collected to build a fingerprint database [22]. Then, the localization is a process of matching the measured fingerprint, at an unknown location, with those in the database. Finally, the location corresponding to the best-fitted fingerprint is returned. Obviously, fingerprint matching is time-consuming and it is labor-intensive to build and maintain the database. AoA, also known as direction of arrival (DoA), refers to the angle of incidence at which radio signals from a transmitter arrive at the receiver. Given two AoAs and their receivers’ positions, the two-dimensional coordinates of the transmitter can be determined by triangulation. Accurate AoA can only be obtained by directional antennas or an antenna array, which makes the receiver complex and expensive.
Since the RSSI can be easily obtained by common mobile terminals, such as smartphones, Wi-Fi devices, Bluetooth beacons, ZigBee sensors, and so on, it is widely used to study wireless localization in range-based and range-free schemes. The fundamental drawback of RSSI is that it only works well in LOS situations. Unlike the RSSI, which is an aggregated value of all of the subcarriers’ amplitudes, the channel state information (CSI) estimates the channel, on each subcarrier, in the frequency domain. The CSI is to RSSI what a rainbow is to a sunbeam, so it can depict a multipath propagation to some extent and possesses more stable and fine-grained localization capability. The CSI can estimate the AoA and the ToF for multipath components under non line of sight (NLOS) conditions [30]. However, it needs to modify the firmware or update the hardware on available commercial devices to obtain the CSI data, which is difficult to implement on handheld devices, like smartphones. More details about the RSSI and the CSI can be found in Reference [31]. It is worth noting that hybrid methods are increasingly introduced in order to enhance the localization performance, such as the RSSI/DV-hop localization algorithm for the WSN, using fingerprinting method to improve the AoA-based ranging technique, the RSSI/AoA-based target localization and tracking, and so on [27,32–34].
In this paper, we propose an efficient AoA-based wireless indoor localization method for the outpatients’ wayfinding, in hospital, using mobile devices, such as tablets, smartphones, smartwatches, and so on. The Wi-Fi access points (APs) with antenna arrays are hung on the ceiling, so that radio signals can reach targets, along straight lines, in most situations. When users inquire about their locations using mobile devices like smartphones, nearby APs will timely return the positions of the APs and the AoAs pointing to the users’ current positions. Then the smartphones efficiently figure out the users’ locations, through geometric calculations. Both the Wi-Fi APs and the smartphones are off-the-shelf. Experimental results show that indoor localization error is less than 2.5 m, about 80%, of the time in LOS environments.
The contributions of this work are: (1) The proposed AoA-based algorithm is to employ only two Aps, at a time, for target localization. (2) The solutions are proven to be in the same form, after all the possible positions where the target may appear are investigated, comprehensively. (3) The calculation only involves a simple tangent function and basic arithmetic operations, which can be efficiently performed on a handheld mobile device.

Sensors 2018, 18, 3698 3 of 17
The rest of this paper is organized as follows. First, Section 2 reviews the related work. Then, Section 3 introduces the design method and localization algorithm, in detail. Section 4 gives the experimental results. Finally, Section 5 concludes this work and discusses future work.
2. Related Work
AoA can be estimated by finding the maximum or minimum signal strength, during the rotation of a directional or a non-ideal omnidirectional monopole antenna [35–38], or when measuring the phase difference of received signals in an antenna array [39–42].
For the directional antenna, it needs an additional mechanical unit to rotate, and takes a long period of time to sample the 360◦ data [43]. So, it is impractical to be equipped in a handheld platform, such as smartphones, smartwatches, tablets, and so on. Zhang et al. proposed an alternative approach to emulate the functionality of a directional antenna, and developed an outdoor AP localization system, called Borealis [44]. In Borealis, a user holds a smartphone in the hand and rotates the body by 360◦, a group of RSSI data is recorded and further processed to estimate the AP direction. Borealis produces 30◦ angular error in simple LOS environment, up to 50◦ in complex LOS, and 65◦ in NLOS environments. SpinLoc adopts a similar localization principle as Borealis, except that it replaces the RSSI by the CSI for indoor scenarios [45]. SpinLoc can produce a median error of 20◦, offering localization accuracies in order of 6.5 m, with 4 Aps, and up to 5 m, with more APs. Jiang et al. proposed an AoA Localization with RSSI Difference (ALRD) system to estimate the AoA by comparing the RSSI values, about the target, received from two perpendicularly-oriented directional antennas, at the beacon nodes [37]. ALRD has an average localization error of 1.24 m at the CDF (Cumulative Distribution Function) = 50% in a 10 × 10 m indoor area. Although the ALRD need not rotate the directional antennas to collect data, it has to rebuild a new fingerprint database of the RSSI values when the target changes.
Antenna array is another common approach to estimate the AoA, by measuring the phase difference between the received signals of the two antennas. The phase difference is caused by the time difference of the signal that arrives in the different antennas, and is essentially determined by the incident angle of the incoming signal. Amundson et al. employed radio interferometric technique to determine the bearing from an anchor node, with an antenna array, to a distant target node, achieving an accuracy of about 3◦ [39]. Based on the above radio interferometric AoA estimation, Amundson et al. designed a localization and navigation system, called the TripNav, which could provide an average position and heading accuracy of 0.95 m and 4.75◦, when traveling indoor at a speed of 1 m/s [23]. However, it requires an accurate time synchronization between the anchor node and the target node, on the order of microseconds. Chen et al. designed a low-cost and flexible antenna array for the AoA estimation, using modular, commercial-off-the-shelf, software-defined radios (SDRs) [42]. The prototype system still needs an additional clock module to synchronize the connected SDRs, for measuring the phase difference of arrival (PDoA), and offers a localization error less than 3 m, in the open field test. In the indoor location system, called the ArrayTrack, a custom FPGA (Field Programmable Gate Array) hardware with sixteen antennas was designed, and a multi-path suppression algorithm, named MUSIC (Multiple Signal Classification), was applied for the AoA estimation [40]. ArrayTrack can pinpoint forty-one clients, over an indoor office environment, to within 0.23 m median accuracy. Tzur et al. used a commercial Intel 5300 Wi-Fi NIC (Network Interface Card) with two receiving antennas to develop a practical method for identifying the AoA of a Wi-Fi AP [46]. In a realistic indoor environment, they are able to acquire the AoA, with a median error of 8–15◦. SpotFi uses a single NIC with three antennas, combining the CSI values across the subcarriers and the antennas to jointly estimate both the AoA and the ToA of each path [47]. The joint estimation procedure enables the SpotFi to provide a similar AoA accuracy that is comparable to systems that require twice as many antennas. Under the LoS conditions, SpotFi can achieve a median error of 5◦. Gjengset et al. used multiple NICs and automatic calibration to achieve a median location accuracy of 0.9 m [41].

Sensors 2018, 18, 3698 4 of 17
3. Methodology
In this section, we first introduce the basic idea of our method. And then we give the detailed description of all possible cases in which the target will appear with regards to the Wi-Fi APs. Finally, we show how to deal with the case in which a target can be accessed by several pairs of APs.
3.1. AoA-Based Localization with Two Known APs
We plot Figure 1 to interpret the AoA-based localization with two known APs. For the convenience of description, all positions and angles in this paper are expressed in the two-dimensional Cartesian coordinate system. And the AoA value is defined to be positive if it is counter-clockwise and negative otherwise. In order to avoid confusion, we further define that the AoA specifically refers to the angle of incidence at which the radio signal travels from the transmitter to the receiver, along a straight line.

In order to provide room-level localization services for hospital outpatients using their own mobile devices, this paper proposed an efficient AoA-based wireless indoor localization algorithm that uses the coordinates and the angles of the arrival, provided by commercial Wi-Fi access points, to estimate the target’s position. Different from the available triangulation or trilateration localization algorithms, which utilize three or more APs and the complicated least square method, the proposed localization algorithm employs only two Aps, at a time, for positioning. All the possible positions in which the target might appear were comprehensively investigated, and the corresponding solutions were proven to be in the same form. Compared to the solution for the binary quadratic equations in the RSSI range-based method, the calculation in our proposed AoA-based method for positioning, only involves a simple tangent function and basic arithmetic operation, which could be efficiently performed on handheld mobile devices, such as smartphones. Two experiments were conducted to evaluate the feasibility and the localization performance. Experimental results showed that localization error was less than 2.5 m, about 80% of the time, in the LOS-dominating environments, which could satisfy the outpatients’ needs for wayfinding, in the hospital.
However, the drawbacks were also obvious. The main disadvantage was that the infrastructure cost would be much higher to build a wireless local area network, using the Cisco 4800 series Aps, rather than deploying other conventional APs. The localization algorithm is also mainly designed for the LOS-dominating environments, which confines its application to a certain extent, in real practice. Therefore, further work could be done to improve this localization method.

Sensors 2018, 18, 3698 15 of 17
First, hybrid methods could be explored to tackle the positioning in the NLOS environments. For example, the AoA might be used in conjunction with a ToF. To be more specific, the phase difference between a pair of adjacent antennas is marked with a time stamp, by taking into account the relative flight time of their received incident radio waves. The AoA, which corresponds to the minimum ToF, could be considered to be the AoA representing the LOS path.
Second, the time spent in positioning needs to be reduced for the sake of a better user experience. In other word, the user should be able to keep on walking at a normal pace during the positioning. The AoAs measurement and acquisition could be accelerated by developing specific applications to get rid of the manual operation.
Last, the APs’ deployment could be optimized to eliminate the blind points. For example, the APs could be staggered in the corridors or hall. When the target happens to be collinear with the two nearest APs, one of the AP should be replaced by another that is nearby.
